<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Guidance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="F# Software Foundation; Microsoft; F# Contributors">

    <link rel="stylesheet" id="theme_link" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.6.0/materia/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>

    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.ico">
    <link type="text/css" rel="stylesheet" href="https://fsharp.github.io/fsharp-compiler-docs/content/navbar-fixed-left.css" />
    <link type="text/css" rel="stylesheet" href="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-default.css" />
    <link type="text/css" rel="stylesheet" href="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-custom.css" />
    <script type="text/javascript" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!-- BEGIN SEARCH BOX: this adds support for the search box -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
    <!-- END SEARCH BOX: this adds support for the search box -->
    
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-light bg-secondary fixed-left" id="fsdocs-nav">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse navbar-nav-scroll" id="navbarsExampleDefault">
            <a href="https://fsharp.github.io/fsharp-compiler-docs/"><img id="fsdocs-logo" src="https://fsharp.github.io/fsharp-compiler-docs/img/logo.png" /></a>
            <!-- BEGIN SEARCH BOX: this adds support for the search box -->
            <div id="header">
                <div class="searchbox" id="fsdocs-searchbox">
                    <label for="search-by">
                        <i class="fas fa-search"></i>
                    </label>
                    <input data-search-input="" id="search-by" type="search" placeholder="Search..." />
                    <span data-search-clear="">
                        <i class="fas fa-times"></i>
                    </span>
                </div>
            </div>

            <!-- END SEARCH BOX: this adds support for the search box -->
            <ul class="navbar-nav">
                <li class="nav-header">Links</li>
                <li class="nav-item" id="fsdocs-license-link"><a class="nav-link" href="https://github.com/dotnet/fsharp/blob/main/License.txt">License</a></li>
                <li class="nav-item" id="fsdocs-release-notes-link"><a class="nav-link" href="https://github.com/dotnet/fsharp/blob/main/release-notes.md">Release Notes</a></li>
                <li class="nav-item" id="fsdocs-repository-link"><a class="nav-link" href="https://github.com/dotnet/fsharp/">Source Repository</a></li>
                <li class="nav-header">
  Compiler Internals
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/overview.html">
    Overview
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/coding-standards.html">
    Coding standards
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/diagnostics.html">
    Diagnostics
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/debug-emit.html">
    Debug emit
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/optimizations.html">
    Optimizations
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/large-inputs-and-stack-overflows.html">
    Large inputs
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/memory-usage.html">
    Memory usage
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/compiler-startup-performance.html">
    Startup Performance
  </a>
</li>             
<li class="nav-header">
  Language Service Internals
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/tooling-features.html">
    Overview
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/project-builds.html">
    Project builds
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/caches.html">
    FSharpChecker caches
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/react.html">
    Incrementality
  </a>
</li>             
<li class="nav-header">
  FSharp.Compiler.Service
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/tokenizer.html">
    Tutorial: Tokenizing
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/untypedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/symbols.html">
    Tutorial: Symbols
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/editor.html">
    Tutorial: Editor services
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/typedtree.html">
    Tutorial: Expressions
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/project.html">
    Tutorial: Project analysis
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/interactive.html">
    Tutorial: Hosted execution
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/compiler.html">
    Tutorial: Hosting the compiler
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/corelib.html">
    Notes on FSharp.Core
  </a>
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fcs/filesystem.html">
    IFileSystem
  </a>
</li>             
<li class="nav-header">
  FSharp.Core
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/fsharp-core-notes.html">
    Guidance
  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="https://fsharp.github.io/fsharp-compiler-docs/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
    </nav>
    <div class="container">
        <div class="masthead">
            <h3 class="muted"><a href="https://fsharp.github.io/fsharp-compiler-docs/">F# Compiler Guide</a></h3>
        </div>
        <hr />
        <div class="container" id="fsdocs-content">
            
<h1><a name="Notes-and-Guidance-on-FSharp-Core" class="anchor" href="#Notes-and-Guidance-on-FSharp-Core">Notes and Guidance on FSharp.Core</a></h1>
<p>This technical guide discusses the FSharp.Core library.</p>
<p>Reference documentation for FSharp.Core can be found here: <a href="https://fsharp.github.io/fsharp-core-docs/">https://fsharp.github.io/fsharp-core-docs/</a></p>
<p>Much of the guidance below applies to any .NET library respecting binary compatibility.</p>
<h2><a name="FSharp-Core-is-binary-compatible" class="anchor" href="#FSharp-Core-is-binary-compatible">FSharp.Core is binary compatible</a></h2>
<p>FSharp.Core is binary compatible across versions of the F# language. For example, this means you can create a newer project with a newer FSharp.Core in an older codebase and things should generally "just work".</p>
<p><strong>Binary compatibility means that a component built for X can bind to Y at runtime. It doesn't mean that Y behaves 100% the same as X, though.</strong> For example, an older compiler that doesn't know how to understand <code>inref&lt;'T&gt;</code> referencing a newer FSharp.Core that has <code>inref&lt;'T&gt;</code> defined may not behave correctly if <code>inref&lt;'T&gt;</code> is used in source.</p>
<h2><a name="FSharp-Core-and-F-scripts" class="anchor" href="#FSharp-Core-and-F-scripts">FSharp.Core and F# scripts</a></h2>
<p>F# scripts, executed by F# interactive, execute against the FSharp.Core deployed with the .NET SDK you are using. If you're expecting to use a more modern library feature and find that it's missing, it's likely because you have an older .NET SDK and thus an older F# Interactive. Upgrade your .NET SDK.</p>
<h2><a name="Guidance-for-package-authors" class="anchor" href="#Guidance-for-package-authors">Guidance for package authors</a></h2>
<p>If you are authoring a NuGet package for consumption in the F# and .NET ecosystem, you already have to make a decision about functionality vs. reach by deciding what target framework(s) you support.</p>
<p>As an F# package author, you also need to make this decision with respect to FSharp.Core:</p>
<ul>
<li>Targeting an earlier version of FSharp.Core increases your reach because older codebases can use it without issue</li>
<li>Targeting a newer version of FSharp.Core lets you use and extend newer features</li>
</ul>
<p>This decision is critical, because it can have a network effect. If you choose a higher FSharp.Core version, then that also becomes a dependency for any other package that may depend on your package.</p>
<h3><a name="Package-authors-should-pin-their-FSharp-Core-reference" class="anchor" href="#Package-authors-should-pin-their-FSharp-Core-reference">Package authors should pin their FSharp.Core reference</a></h3>
<p>The default templates for F# projects carry an implicit reference to FSharp.Core. This is ideal for application developers, since applications almost always want to be referencing the highest FSharp.Core available to them. As you upgrade your .NET SDK, the FSharp.Core package referenced implicitly will also be upgraded over time, since FSharp.Core is also distributed with the .NET SDK.</p>
<p>However, as a package author this means that unless you reference FSharp.Core explicitly, you will default to the latest possible version and thus eliminate any hope of reaching older projects in older environments.</p>
<h3><a name="How-to-explicitly-reference-FSharp-Core" class="anchor" href="#How-to-explicitly-reference-FSharp-Core">How to explicitly reference FSharp.Core</a></h3>
<p>It's a simple gesture in your project file that pins to FSharp.Core 4.7.2:</p>
<table class="pre"><tr><td class="snippet"><pre class="fssnip highlighted"><code lang="xml"><span class="k">&lt;</span><span class="i">ItemGroup</span><span class="k">&gt;</span>
  <span class="k">&lt;</span><span class="i">PackageReference</span> <span class="o">Update</span><span class="k">="FSharp.Core"</span> <span class="o">Version</span><span class="k">="4.7.2"</span> <span class="k">/&gt;</span>
<span class="k">&lt;/</span><span class="i">ItemGroup</span><span class="k">&gt;</span>
</code></pre></td></tr></table>
<p>Or if you're using Paket:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">nuget</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">Core</span> <span class="pn">&gt;</span><span class="o">=</span> <span class="n">4.7</span><span class="pn">.</span><span class="n">2</span>
</code></pre>
<p>And that's it!</p>
<h3><a name="Compatibility-table" class="anchor" href="#Compatibility-table">Compatibility table</a></h3>
<p>The following table can help you decide the minimum language/package version you want to support:</p>
<table>
<thead>
<tr class="header">
<th><p>Minimum F# language version</p></th>
<th><p>Minimum FSharp.Core package version</p></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>F# 4.1</p></td>
<td><p>4.3.4</p></td>
</tr>
<tr class="even">
<td><p>F# 4.5</p></td>
<td><p>4.5.2</p></td>
</tr>
<tr class="odd">
<td><p>F# 4.6</p></td>
<td><p>4.6.2</p></td>
</tr>
<tr class="even">
<td><p>F# 4.7</p></td>
<td><p>4.7.2</p></td>
</tr>
<tr class="odd">
<td><p>F# 5.0</p></td>
<td><p>5.0.0</p></td>
</tr>
<tr class="even">
<td><p>F# 6.0</p></td>
<td><p>6.0.0</p></td>
</tr>
</tbody>
</table>

<p>If you want to be compatible with much older projects using an F# 4.0 compiler or earlier, you can still do that but it's not recommended. People using those codebases should upgrade instead.</p>
<h3><a name="Do-not-bundle-FSharp-Core-directly-with-a-library" class="anchor" href="#Do-not-bundle-FSharp-Core-directly-with-a-library">Do <em>not</em> bundle FSharp.Core directly with a library</a></h3>
<p>Do <em>not</em> include a copy of FSharp.Core with your library or package, such in the <code>lib</code> folder of a package. If you do this, you will create havoc for users of your library.</p>
<p>The decision about which <code>FSharp.Core</code> a library binds to is up to the application hosting of the library.</p>
<h2><a name="Guidance-for-everyone-else" class="anchor" href="#Guidance-for-everyone-else">Guidance for everyone else</a></h2>
<p>If you're not authoring packages for distribution, you have a lot less to worry about.</p>
<p>If you are distributing library code across a private organization as if it were a NuGet package, please see the above guidance, as it likely still applies. Otherwise, the below guidance applies.</p>
<h3><a name="Application-authors-don-t-have-to-explicitly-reference-FSharp-Core" class="anchor" href="#Application-authors-don-t-have-to-explicitly-reference-FSharp-Core">Application authors don't have to explicitly reference FSharp.Core</a></h3>
<p>In general, applications can always just use the latest FSharp.Core bundled in the SDK they are built with.</p>
<h3><a name="C-projects-referencing-F-projects-may-need-to-pin-FSharp-Core" class="anchor" href="#C-projects-referencing-F-projects-may-need-to-pin-FSharp-Core">C# projects referencing F# projects may need to pin FSharp.Core</a></h3>
<p>You can reference an F# project just fine without needing to be explicit about an FSharp.Core reference when using C# projects based on the .NET SDK. References flow transitively for SDK-style projects, so even if you need to use types directly from FSharp.Core (which you probably shouldn't do anyways) it will pick up the right types from the right assembly.</p>
<p>If you do have an explicit FSharp.Core reference in your C# project that you <strong>need</strong>, you should pin your FSharp.Core reference across your entire codebase. Being in a mixed pinned/non-pinned world is difficult to keep straight over a long period of time.</p>
<h2><a name="Guidance-for-older-projects-compilers-and-tools" class="anchor" href="#Guidance-for-older-projects-compilers-and-tools">Guidance for older projects, compilers, and tools</a></h2>
<p>Modern .NET development, including F#, uses SDK-style projects. You can read about that here: <a href="https://docs.microsoft.com/dotnet/core/project-sdk/overview">https://docs.microsoft.com/dotnet/core/project-sdk/overview</a></p>
<p>If you are not using SDK-style projects F# projects and/or have an older toolset, the following guidance applies.</p>
<h3><a name="Consider-upgrading" class="anchor" href="#Consider-upgrading">Consider upgrading</a></h3>
<p>Yes, really. The old project system that manages legacy projects is not that good, the compiler is older and unoptimized for supporting larger codebases, tooling is not as responsive, etc. You will really have a much better life if you upgrade. Try out the <code>try-convert</code> tool to do that: <a href="https://github.com/dotnet/try-convert">https://github.com/dotnet/try-convert</a></p>
<p>If you cannot upgrade for some reason, the rest of the guidance applies.</p>
<h3><a name="Always-deploy-FSharp-Core-as-part-of-a-compiled-application" class="anchor" href="#Always-deploy-FSharp-Core-as-part-of-a-compiled-application">Always deploy FSharp.Core as part of a compiled application</a></h3>
<p>For applications, FSharp.Core is normally part of the application itself (so-called "xcopy deploy" of FSharp.Core).</p>
<p>For older project files, you may need to use <code>&lt;Private&gt;true&lt;/Private&gt;</code> in your project file. In  Visual Studio this is equivalent to setting the <code>CopyLocal</code> property to <code>true</code> properties for the <code>FSharp.Core</code> reference.</p>
<p>FSharp.Core.dll will normally appear in the <code>bin</code> output folder for your application. For example:</p>
<pre class="fssnip highlighted"><code lang="fsharp">    <span class="id">Directory</span> <span class="k">of</span> <span class="o">..</span><span class="pn">.</span>
    
    <span class="n">18</span><span class="o">/</span><span class="n">04</span><span class="o">/</span><span class="n">2020</span>  <span class="n">13</span><span class="pn">:</span><span class="n">20</span>             <span class="n">5</span><span class="pn">,</span><span class="n">632</span> <span class="id">ConsoleApplication3</span><span class="pn">.</span><span class="id">exe</span>
    <span class="n">14</span><span class="o">/</span><span class="n">10</span><span class="o">/</span><span class="n">2020</span>  <span class="n">12</span><span class="pn">:</span><span class="n">12</span>         <span class="n">1</span><span class="pn">,</span><span class="n">400</span><span class="pn">,</span><span class="n">472</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="id">Core</span><span class="pn">.</span><span class="id">dll</span>
</code></pre>
<h3><a name="FSharp-Core-and-static-linking" class="anchor" href="#FSharp-Core-and-static-linking">FSharp.Core and static linking</a></h3>
<p>The ILMerge tool and the F# compiler both allow static linking of assemblies including static linking of FSharp.Core.
This can be useful to build a single standalone file for a tool.</p>
<p>However, these options must be used with caution.</p>
<ul>
<li>Only use this option for applications, not libraries. If it's not a .EXE (or a library that is effectively an application) then don't even try using this option.</li>
</ul>
<p>Searching on stackoverflow reveals further guidance on this topic.</p>
<h2><a name="Reference-FSharp-Core-version-and-NuGet-package-numbers" class="anchor" href="#Reference-FSharp-Core-version-and-NuGet-package-numbers">Reference: FSharp.Core version and NuGet package numbers</a></h2>
<p>See <a href="https://github.com/fsharp/fslang-design/blob/master/tooling/FST-1004-versioning-plan.md">the F# version information RFC</a>.</p>

            <div class="fsdocs-tip" id="fs1">namespace Microsoft.FSharp</div>
<div class="fsdocs-tip" id="fs2">namespace Microsoft.FSharp.Core</div>

        </div>

        <!-- BEGIN SEARCH BOX: this adds support for the search box -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.css" />
        <script type="text/javascript">var fsdocs_search_baseurl = 'https://fsharp.github.io/fsharp-compiler-docs/';</script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/JavaScript-autoComplete/1.0.4/auto-complete.min.js"></script>
        <script type="text/javascript" src="https://fsharp.github.io/fsharp-compiler-docs/content/fsdocs-search.js"></script>
        <!-- END SEARCH BOX: this adds support for the search box -->
    </div>
</body>

</html>